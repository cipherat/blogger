<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>* register | cipherat.com</title>
    <link rel="stylesheet" href="{{ url_for('static', path='/styles.css') }}"> 
    <style>
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-weight: bold; margin-bottom: 5px; }
        .form-group input[type="text"], .form-group input[type="date"], .form-group textarea, .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            box-sizing: border-box; 
            font-family: 'Ubuntu Mono', monospace;
        }
        .form-group textarea { height: 150px; }
        .form-error { color: #cc0000; margin-bottom: 15px; font-weight: bold; }
        .submit-button { 
            background-color: #1c1c1c; 
            color: #ffffff; 
            border: none; 
            padding: 10px 20px; 
            cursor: pointer; 
            font-family: 'Ubuntu Mono', monospace;
        }
    </style>
</head>
<body>

     <header>
         <div class="container">
             <h1>.: BLOG REGISTERATION | ADMIN PANEL :.</h1>
         </div> 
     </header>

    <div class="container">
        
        {% if errors and errors.get('submission') %}
            <div class="form-error">{{ errors.submission }}</div>
        {% endif %}

        <form method="POST" action="{{ url_for('register_submission') }}">
            
            <div class="form-group">
                <label for="title">Title:</label>
                <input type="text" id="title" name="title" value="{{ form_data.get('title', '') }}" required>
            </div>
            
            <div class="form-group">
                <label for="category">Category:</label>
                <input type="text" id="category" name="category" value="{{ form_data.get('category', '') }}" required>
            </div>

            <div class="form-group">
                <label for="published_at_str">Publication Date (YYYY-MM-DD):</label>
                {# Guarded access to nested dates to prevent UndefinedError on first load #}
                {% set pub_date = '' %}
                {% if form_data.dates is defined and form_data.dates.published_at %}
                    {% set pub_date = form_data.dates.published_at.strftime('%Y-%m-%d') %}
                {% elif form_data.get('published_at_str') %}
                    {% set pub_date = form_data.get('published_at_str') %}
                {% endif %}
                <input type="date" id="published_at_str" name="published_at_str" value="{{ pub_date }}" required>
                {% if errors and errors.get('published_at') %}<div class="form-error">{{ errors.published_at }}</div>{% endif %}
            </div>

            <div class="form-group">
                <label for="content_file">Content File Path/URL (.md):</label>
                <input type="text" id="content_file" name="content_file" value="{{ form_data.get('content_file', '') }}" required>
            </div>
            
            <div class="form-group">
                <label for="keywords_csv">Keywords (Comma-separated list):</label>
                {# Safely handle both list and string types for keywords #}
                {% set kw_val = form_data.get('keywords', '') %}
                <input type="text" id="keywords_csv" name="keywords_csv" 
                       value="{{ kw_val | join(', ') if kw_val is iterable and kw_val is not string else kw_val }}" required>
            </div>

            <div class="form-group">
                <label for="references_csv">References (Comma-separated List):</label>
                {% set ref_val = form_data.get('references', '') %}
                <input type="text" id="references_csv" name="references_csv" 
                       value="{{ ref_val | join(', ') if ref_val is iterable and ref_val is not string else ref_val }}">
            </div>
            
            <div class="form-group">
                <label for="state">State:</label>
                <select id="state" name="state">
                    {% for s in states %}
                        {% set opt_val = s.value if s.value is defined else s %}
                        {# Safe retrieval of current state from dict or object #}
                        {% set current_state = '' %}
                        {% if form_data.state is defined %}
                            {% set current_state = form_data.state.value if form_data.state.value is defined else form_data.state %}
                        {% else %}
                            {% set current_state = form_data.get('state', '') %}
                        {% endif %}

                        <option value="{{ opt_val }}" 
                            {% if (current_state == opt_val) or (loop.first and not current_state) %}selected{% endif %}>
                            {{ opt_val | upper }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            
            <button type="submit" class="submit-button">Register Blog Post</button>
        </form>

    </div>
</body>
</html>
